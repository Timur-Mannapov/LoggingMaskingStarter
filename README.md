# Logging and Masking Starter Library

## Описание

Этот проект представляет собой Spring Boot стартер, разработанный для обеспечения гибкого и настраиваемого логирования и маскирования конфиденциальных данных в приложениях, использующих Spring Framework. Библиотека предоставляет возможность логировать HTTP-запросы/ответы, а также сообщения, обрабатываемые асинхронно, например, в Kafka. Ключевым аспектом является возможность маскирования чувствительных данных, таких как пароли, номера кредитных карт или личные идентификаторы, в логах, обеспечивая соблюдение требований безопасности и конфиденциальности.

Библиотека предоставляет следующие возможности:

*   **Логирование HTTP:** Автоматическое логирование входящих и исходящих HTTP-запросов, включая метод, URL, статус, заголовки и тела.
*   **Маскирование данных:**  Гибкая и настраиваемая маскировка конфиденциальных данных в логах с использованием различных стратегий.
*   **Логирование Kafka:** Поддержка логирования сообщений Kafka с возможностью маскирования данных.
*   **Конфигурация:**  Настройка логирования и маскировки с помощью простых свойств в `application.properties` или `application.yml`.
*   **Actuator Endpoints:**  Управление и мониторинг параметров логирования и маскировки с помощью Actuator endpoints.
*   **Расширяемость:** Легкая интеграция новых алгоритмов маскировки через интерфейс `Masker`.

## Стек технологий

*   **Java 17+:** Основной язык программирования.
*   **Spring Boot:** Фреймворк для создания автономных, готовых к производству Spring-приложений.
*   **Spring Web:** Для обработки HTTP-запросов и ответов.
*   **Spring Kafka:** Для работы с Apache Kafka.
*   **Spring Boot Actuator:** Для мониторинга и управления приложением.
*   **Lombok:** Для уменьшения шаблонного кода.
*   **Jackson:** Для сериализации и десериализации JSON.
*   **SLF4j:**  Для логирования.
*   **Validation API:** Для проверки конфигурации.

## Ключевые компоненты

*   **`Masker` (интерфейс):** Определяет контракт для реализации различных стратегий маскировки.
*   **`MaskingContext`:**  Передает контекстную информацию для маскировки (например, путь к данным, тип маскировки).
*   **`RegexMasker`:** Пример реализации `Masker` для маскировки данных по регулярному выражению.
*   **`StarterMasker`:** Пример реализации `Masker` для замены всех символов на звёздочки.
*   **`LoggingInterceptor`:**  Интерсептор для перехвата HTTP-запросов/ответов и логирования, а также применения маскировки.
*   **`KafkaLoggingListener`:**  Слушатель Kafka для логирования сообщений, а также применения маскировки.
*   **`EndpointLoggingProperties`:** Класс для хранения настроек конфигурации логирования и маскировки.
*   **`LoggingAutoConfiguration`:**  Автоматическая конфигурация для включения логирования и маскировки.
*   **`LoggingEnvironmentPostProcessor`:** Проверяет правильность конфигурации `endpoint.logging.active` при запуске приложения.
*   **`LoggingFailureAnalyzer`:** Обеспечивает более информативное сообщение об ошибке в случае неправильной конфигурации.
*   **`HttpLog`:**  Класс для хранения информации о HTTP-запросе, готовый к сериализации.

## Использование

1.  **Добавьте зависимость в ваш `pom.xml`:**

    ```xml
    <dependency>
        <groupId>org.example</groupId>
        <artifactId>logging-masking-starter</artifactId>
        <version>0.0.1-SNAPSHOT</version>
    </dependency>
    ```

2.  **Настройте параметры в `application.yml`:**

    ```yaml
    endpoint:
      logging:
        active: true  # Включить логирование и маскировку
        maskingEnabled: true # Включить маскировку
        requestBodySizeLimit: 2048 # Максимальный размер тела запроса для логирования
        responseBodySizeLimit: 4096 # Максимальный размер тела ответа для логирования
        maskingRules:
          request.headers.Authorization:
            maskingType: RegexMasker  # Маскировка заголовка Authorization
          request.body:
            maskingType: StarterMasker # Маскировка тела запроса
          kafka.message:
            maskingType: StarterMasker # Маскировка сообщений Kafka
    ```

3.  **Доступ к Actuator Endpoints:**
    *   `/actuator/logging-masking`: Для просмотра текущей конфигурации маскировки.
    *   `/actuator/logging-active`: Для просмотра текущего статуса логирования.
    
4.  **Расширение функционала маскировки:**

    *   Создайте класс, реализующий интерфейс `Masker`.
    *   Добавьте бин `Masker` в ваш Spring-контекст (например, через `@Component`).
    *   Укажите тип нового маскировщика в настройках `maskingRules`.

5.  **Пример использования Kafka (при наличии Kafka в проекте):**

    *   Подключите и настройте Kafka в вашем проекте.
    *   Сообщения, принимаемые вашими Kafka listener-ами будут автоматически логироваться и маскироваться в соответствии с настройками.
